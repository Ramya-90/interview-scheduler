<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Edit Interviewers</title>

    <link href="/static/css/qxf2_scheduler.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"
        id="bootstrap-css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <style>
        .bs-example {
            margin: 20px;
        }

        textarea {
            display: inline
        }
    </style>
</head>

<body>
    <div class="modal" id="myModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">Confirmation</h4>
                </div>
                <div class="modal-body">
                    <p>Success:</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" onclick="redirectNew()"
                        data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class="bs-example">
        <form class="form-horizontal">
            <!-- Form Name -->
            <h2 class="grey_text text-justify">Edit Interviewers</h2>
            <!-- Text input-->
            {% if result is mapping %}
            <div class="form-group">
                <label class="col-md-4 control-label" for="fname">First Name</label>
                <div class="col-md-4">
                    <input id="fname" name="fname" type="text" placeholder="John" class="form-control input-md"
                        value="{{result.interviewers_name}}" required="">
                </div>
            </div>

            <!-- Text input-->
            <div class="form-group">
                <label class="col-md-4 control-label" for="email">Email</label>
                <div class="col-md-4">
                    <input id="email" name="email" type="text" placeholder="johndoe@example.com"
                        value="{{result.interviewers_email}}" class="form-control input-md" required="">

                </div>
            </div>

            <!-- Text input-->
            <div class="form-group">
                <label class="col-md-4 control-label" for="designation">Designation</label>
                <div class="col-md-4">
                    <input id="designation" name="designation" type="text" placeholder="QA"
                        value="{{result.interviewers_designation}}" class="form-control input-md" required="">

                </div>
            </div>
        </form>
        <table id="timeTable" style="width: 100%">
            <tr>
                <td>
                    {% set counter = 0 %}
                    <input type="hidden" id="TestHidden" value="{{counter}}" ></td> </tr> </table> </form> <div>
                    <input class="btn btn-link" onclick="addtextbox()" type="button" value="Add">
    </div>
    <div id="ToolsGroup">
    </div>
    <!-- Button (Double) -->
    <form class="form-horizontal">
        <div class="form-group">
            <label class="col-md-4 control-label" for="save"></label>
            <div class="col-md-8">
                <input class="btn btn-success" type='button' id='submit' value='Save'>
                <input type='button' id="clear" value='Cancel' onclick="redirectNew()" class="btn btn-danger">
            </div>
        </div>
    </form>
    </form>
    </table>
    {% else %}
    {% for each_details in result %}
    <div class="form-group">
        <label class="col-md-4 control-label" for="fname">First Name</label>
        <div class="col-md-4">
            <input id="fname" name="fname" type="text" placeholder="John" class="form-control input-md"
                value="{{each_details['interviewers_name']}}" required="">

        </div>
    </div>

    <!-- Text input-->
    <div class="form-group">
        <label class="col-md-4 control-label" for="email">Email</label>
        <div class="col-md-4">
            <input id="email" name="email" type="text" placeholder="johndoe@example.com"
                value="{{each_details['interviewers_email']}}" class="form-control input-md" required="">

        </div>
    </div>

    <!-- Text input-->
    <div class="form-group">
        <label class="col-md-4 control-label" for="designation">Designation</label>
        <div class="col-md-4">
            <input id="designation" name="designation" type="text" placeholder="QA"
                value="{{each_details['interviewers_designation']}}" class="form-control input-md" required="">

        </div>
    </div>
    </form>
    <form class="form-inline">
        <table id="timeTable" style="width: 100%">
            {% for each_slot in each_details['time'] %}
            <tr id="time-slot-{{loop.index}}">
                <td>
                    <label class="col-md-4 control-label" for="starttime">Starttime</label>
                </td>
                <td>
                    <input type="startime" class="form-control input-md" id="starttime{{loop.index}}"
                        placeholder="starttime" value="{{each_slot['starttime']}}" required="">


                </td>
                <td>
                    <label class="col-md-8 control-label" for="endtime">Endtime</label>
                </td>
                <td>
                    <input type="endtime" class="form-control input-md" id="endtime{{loop.index}}"
                        value="{{each_slot['endtime']}}" placeholder="endtime" required="">
                </td>
                <td>
                    <input type="button" value="Remove" onclick="removeButton({{loop.index}})" class="btn btn-link">
                </td>
            </tr>
            <br />
            {% endfor %}

            <tr>
                <td>
                    {% set counter = each_details['time'] | length %}
                    <input type="hidden" id="TestHidden" value="{{counter}}"> </td> </tr> </table> </form> <div>
                    <input class="btn btn-link" onclick="addtextbox()" type="button" value="Add">
                    </div>
                    <div id="ToolsGroup">
                    </div>

                    <!-- Button (Double) -->
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label class="col-md-4 control-label" for="save"></label>
                            <div class="col-md-8">
                                <input class="btn btn-success" type='button' id='submit' value='Save'>
                                <input type='button' id="clear" value='Cancel' onclick="redirectNew()"
                                    class="btn btn-danger">
                            </div>
                        </div>
                    </form>
    </form>
    {% endfor %}
    {% endif %}
    </div>
    <script>
        timeObject = {
            starttime: [],
            endtime: []
        };
        $("#submit").click(function () {
            var id = $("#intid").val();
            var email = $("#email").val();
            var name = $("#fname").val();
            var designation = $("#designation").val();
            var timeSlotTable = document.getElementById("timeTable");
            var count = timeSlotTable.rows.length;
            console.log(count);
            for (var index = 1; index <= count; index++) {
                var starttimeVal = $("#starttime" + index).val();
                console.log(typeof starttimeVal, starttimeVal)
                if (starttimeVal != undefined) {
                    timeObject.starttime.push($("#starttime" + index).val())
                    timeObject.endtime.push($("#endtime" + index).val())
                }
            }
            console.log(timeObject);
            $.ajax({
                type: 'POST',
                url: '/interviewers/%d/edit' % id,
                data: {
                    'email': email,
                    'name': name,
                    'designation': designation,
                    'timeObject': JSON.stringify(timeObject)
                },

                success: function (result) {
                    var msg = " The interviewer " + ' ' + result.interviewer_name + ' ' + " has been edited successfully";
                    $('#myModal').modal('show');
                    $('#myModal .modal-body p').html(msg);
                }

            })
        })
    </script>
    <script>
        var count = 0;
        function addtextbox() {
            debugger;
            var countTest = document.getElementById("TestHidden").value;

            if (countTest > 0) {
                count = countTest;
            }
            count++;
            var newTextBoxDiv = document.createElement('div');
            newTextBoxDiv.id = 'Tools';
            document.getElementById("ToolsGroup").appendChild(newTextBoxDiv);

            newTextBoxDiv.innerHTML = '<form class="form-inline"><div class="form-group"><label class="col-md-4 control-label" for="starttime">Starttime</label><div class="col-md-4"><input type="startime" class="form-control input-md" id="starttime' + count + '" placeholder="starttime" required=""> </div></div>' +
                '<div class="form-group"><label class="col-md-4 control-label" for="endtime">Endtime</label><div class="col-md-4"><input type="endtime" class="form-control input-md" id="endtime' + count + '" placeholder="endtime" required=""></div></div></form>' +
                '<input type="button" value="Remove" class="btn btn-link" onclick="removeTextArea(this);">'
            console.log("Iam count", count);
        };

        function removeTextArea(inputElement) {
            var el = inputElement;
            while (el.tagName != 'DIV') el = el.parentElement;
            el.parentElement.removeChild(el);
            counter--;
        }

    </script>
    <script>
        function redirectNew() {
            document.location.href = "/interviewers"
        }
    </script>
    <script>
        //$(document).on('click', '.RemoveBtn', function () {
        //  $(this).closest('tr').remove();
        // });
        function removeButton(loopIndex) {
            console.log(loopIndex);
            var row_id = "time-slot-" + loopIndex;
            console.log(row_id);
            var elem = document.getElementById(row_id);
            elem.parentNode.removeChild(elem);
        }
    </script>
</body>

</html>