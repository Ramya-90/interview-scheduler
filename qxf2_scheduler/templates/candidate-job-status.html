<html>

<head>
    <title>
        Candidate job status
    </title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--Stylesheets-->
    <link href="/static/css/qxf2_scheduler.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href="http://getbootstrap.com/2.3.2/assets/css/bootstrap.css" rel="stylesheet" />
    <link href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">

    <!--JS-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>



</head>

<body>
    <h2 class="grey_text text-center">Candidate Details</h2>
    <div class="container col-md-offset-1">
        <div class="container col-md-offset-1">
            <div id="form">
                <form>
                    <fieldset>
                        {% if result!="" %}
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Candidate Name:">Candidate Name:</label>
                            <label class="col-md-8" for="candidateName">{{result.candidate_name}}</label>

                        </div>
                        <br>
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Job Applied:">Job Applied:</label>
                            <label class="col-md-8" for="jobApplied">{{result.job_applied}}</label>
                        </div>
                        <br>
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Interviewer details:">Interviewer Email:</label>
                            {% if result.interviewer_email_id == None%}
                            <label class="col-md-8" for="interviewerDetails">Interview not yet scheduled</label>
                            {% else %}
                            <label class="col-md-8" for="interviewerDetails">{{result.interviewer_email_id}}</label>
                            {% endif %}
                        </div>
                        <br>
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Date Applied:">Date Applied:</label>
                            <label class="col-md-8" for="dateApplied">{{result.date_applied}}</label>
                        </div>
                        <br>
                        {% if result.candidate_status == 'Waiting on Qxf2'%}

                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Action:">Action:</label>
                            <input class="btn btn-info" type="button" value="Thumbs up" id="sendEmail"
                                data-generated-url="{{result.url}}" data-candidate-name="{{result.candidate_name}}"
                                data-candidate-email="{{result.candidate_email}}"
                                data-candidate-id="{{result.candidate_id}}" data-job-id="{{result.job_id}}">
                            <input type="button" value="Thumbs down" id="thumbsDown">
                        </div>
                        <br>
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Candidate Status">Candidate Status:</label>
                            <label class="col-md-8" for="takeAction">Waiting on Qxf2</label>
                        </div>
                        {% elif result.candidate_status == 'Interview Scheduled' %}
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Action">Action:</label>
                            <label class="col-md-8" for="interviewScheduled">No action needed from Qxf2</label>
                        </div>
                        <br>
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Candidate Status">Candidate Status:</label>
                            <label class="col-md-8" for="interviewScheduled">Interview Scheduled</label>
                        </div>
                        {% elif result.candidate_status == 'Waiting on Candidate' %}
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Action">Action:</label>
                            <label class="col-md-8" for="action">No action needed from Qxf2</label>
                        </div>
                        <br>
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Candidate Status">Candidate Status:</label>
                            <label class="col-md-8" for="inviteSent">Waiting on Candidate</label>
                        </div>
                        {% elif result.candidate_status == 'Waiting for new opening' %}
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Action">Action:</label>
                            <label class="col-md-8" for="action">No action needed from Qxf2</label>
                        </div>
                        <br>
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Candidate Status">Candidate Status:</label>
                            <label class="col-md-8" for="inviteSent">Waiting for new opening</label>
                        </div>
                        {% endif %}
            </div>

            {% endif %}
            <div class="container col-md-offset-1">
                <input type="button" onclick="noOpening()" value="No opening">
            </div>
            </fieldset>
            </form>
        </div>
    </div>
    </div>

    <div id="dialog-form" title="Send Email Invite">
        <form>
            <fieldset>
                <input type="hidden" id="candidateName" value="{{result.candidate_name}}">
                <input type="hidden" id="candidateEmail" value="{{result.candidate_email}}">
                <input type="hidden" id="candidateId" value="{{result.candidate_id}}">
                <input type="hidden" id="jobId" value="{{result.job_id}}">
                <label for="select1">Round Level</label>
                <div class="col-md-4">
                    <select required name="select1" id="select1" style="width:200px; height:30px;">
                        <option value=" ">Select the below option</option>
                        {% for each_round in round_names %}
                        <option value="{{each_round.round_id,each_round.round_name}}">{{each_round.round_name}}</option>
                        {% endfor %}
                    </select>
                    <div class="valid-feedback">Valid</div>
                    <div class="invalid-feedback">Please fill out this field</div>
                    <input id="generateUrl" value="generate url" style="display:none;" size="40%" readonly>
                    <input type="button" class="btn btn-info" style="display:none;" value="Generate URL"
                        id="urlbutton"></input>
                </div>
                <div id="resultDiv">
                    <textarea name="rdesc" id="rdesc" style="width:200px; height:300px; display:none;"
                        required></textarea>
                    <input type="hidden" id="roundId">
                    <input type="hidden" id="roundName">
                    <input type="hidden" id="roundTime">
                </div>


    </div>
    <script>
        $("#select1").on('change', function () {
            $('#err-name').empty();
            $("#urlbutton").click()
            var dropdownValue = document.getElementById("select1");
            var roundName = dropdownValue.options[dropdownValue.selectedIndex].value;
            $("#generateUrl").show();
            $.ajax({
                type: 'POST',
                url: '/roundname/get-description',
                data: {
                    'round_name': roundName
                },
                success: function (roundResults) {
                    console.log(roundResults.round_time);
                    $("#rdesc").show();
                    $("#rdesc").text(roundResults.round_description);
                    $("#roundId").val(roundResults.round_id);
                    $("#roundName").val(roundResults.round_name);
                    $("#roundTime").val(roundResults.round_time);

                }

            })


        })

    </script>

    <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
    </fieldset>
    </form>
    </div>
    <script>
        var candidateId = "{{ result.candidate_id }}";
        var jobId = "{{ result.job_id }}";
        $("#urlbutton").click(function () {
            $.ajax({
                type: 'POST',
                url: '/candidate/url',
                data: {
                    'candidateId': candidateId,
                    'jobId': jobId
                },
                success: function (data) {
                    var url_textbox = document.getElementById("generateUrl");
                    url_textbox.setAttribute('value', data.url);
                }
            })
        })
    </script>


    <script>
        var form, dialog
        function sendEmail() {
            var isValid = true;
            var generatedUrl = $("#generateUrl").val();
            var candidateName = document.getElementById("candidateName").value;
            var candidateEmail = document.getElementById("candidateEmail").value;
            var candidateId = document.getElementById("candidateId").value;
            var jobId = document.getElementById("jobId").value;
            var roundDescription = document.getElementById("rdesc").value;
            var roundId = document.getElementById("roundId").value;
            var roundName = document.getElementById("roundName").value;
            var roundTime = document.getElementById("roundTime").value;
            $('#err-name').empty();
            if (roundDescription == '') {
                isValid = false;
                console.log("I am coming here");                              
                $("#select1").after('<span id="err-name" class="error" style="color:red">Please select the round</span>')
            }
            if (isValid == true) {
                $.ajax({
                    type: 'POST',
                    url: '/candidate/' + candidateId + '/job/' + jobId + '/invite',
                    data: {
                        'generatedurl': generatedUrl,
                        'candidatename': candidateName,
                        'candidateid': candidateId,
                        'candidateemail': candidateEmail,
                        'jobid': jobId,
                        'rounddescription': roundDescription,
                        'roundid': roundId,
                        'roundname': roundName,
                        'roundtime': roundTime
                    },
                    success: function (result) {

                        if (result.error == "Success") {
                            alert("The Invite has been sent");
                            document.location.href = "/candidates";

                        }
                        else {
                            alert("The invite cannot be sent");
                            document.location.href = "/candidates";
                        }

                    }
                })

                dialog.dialog("close");
            }
        }
        dialog = $("#dialog-form").dialog({
            autoOpen: false,
            height: 400,
            width: 350,
            modal: true,
            buttons: {
                "Send Email": sendEmail,
                Cancel: function () {
                    dialog.dialog("close");
                }
            },
            close: function () {
                dialog.dialog("close");

            }
        });


        $("#sendEmail").button().on("click", function () {
            var generatedUrl = $(this).attr("data-generated-url");
            $("#generatedUrl").val(generatedUrl);
            dialog.dialog("open");
        });
    </script>
    <script>
        function noOpening() {
            var candidateName = document.getElementById("candidateName").value;
            var candidateEmail = document.getElementById("candidateEmail").value;
            var candidateId = document.getElementById("candidateId").value;
            var jobId = document.getElementById("jobId").value;
            $.ajax({
                type: 'POST',
                url: "/noopening/email",
                data: {
                    'candidatename': candidateName,
                    'candidateid': candidateId,
                    'candidateemail': candidateEmail,
                    'candidatejob': jobId
                },
                success: function (result) {
                    if (result.error == "Success") {
                        alert("The no opening email has been sent");
                        document.location.href = "/candidates";

                    }
                    else {
                        alert("The no opening email cannot be sent");
                        document.location.href = "/candidates";
                    }

                }


            })
        }
    </script>

</body>

</html>