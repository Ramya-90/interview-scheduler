<html>

<head>
    <title>
        Candidate job status
    </title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--Stylesheets-->
    <link href="/static/css/qxf2_scheduler.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href="http://getbootstrap.com/2.3.2/assets/css/bootstrap.css" rel="stylesheet" />
    <link href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">

    <!--JS-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>



</head>

<body>
    <h2 class="grey_text text-center">Candidate Details</h2>
    <div class="container col-md-offset-1">
        {% if result.url=="" %}
        <div class="col-md-8">
            <input id="generate-url" value="generate url" size="40%" readonly />
            <button class="btn btn-info" id="urlbutton" type="submit">Generate URL</button>
        </div>
        {% else %}
        <div class="col-md-8">URL:
            <input id="generate-url" value="{{ result.url }}" size="40%" readonly />
            <button class="btn btn-info" id="welcomeButton" onclick="welcome()" type="submit">Click Me</button>
        </div>
        {% endif %}
        <div class="container col-md-offset-1">
            <div id="form">
                <form>
                    <fieldset>
                        {% if result!="" %}
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Candidate Name:">Candidate Name:</label>
                            <label class="col-md-8" for="candidateName">{{result.candidate_name}}</label>

                        </div>
                        <br>
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Job Applied:">Job Applied:</label>
                            <label class="col-md-8" for="jobApplied">{{result.job_applied}}</label>
                        </div>
                        <br>
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Date Applied:">Date Applied:</label>
                            <label class="col-md-8" for="dateApplied">{{result.date_applied}}</label>
                        </div>
                        <br>
                        {% if result.candidate_status == 'Waiting on qxf2'%}
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Action:">Action:</label>
                            <input class="btn btn-info" type="button" value="Thumbs up" id="sendEmail"
                                data-generated-url="{{result.url}}" data-candidate-name="{{result.candidate_name}}"
                                data-candidate-email="{{result.candidate_email}}"
                                data-candidate-id="{{result.candidate_id}}" data-job-id="{{result.job_id}}">
                            <input type="button" value="Thumbs down" id="thumbsDown">
                        </div>
                        <br>
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Candidate Status">Candidate Status:</label>
                            <label class="col-md-8" for="takeAction">Waiting on Qxf2</label>
                        </div>
                        {% elif result.candidate_status == 'Interview Scheduled' %}
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Action">Action:</label>
                            <label class="col-md-8" for="interviewScheduled">No action needed from Qxf2</label>
                        </div>
                        <br>
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Candidate Status">Candidate Status:</label>
                            <label class="col-md-8" for="interviewScheduled">Interview Scheduled</label>
                        </div>
                        {% elif result.candidate_status == 'Waiting on candidate' %}
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Action">Action:</label>
                            <label class="col-md-8" for="action">No action needed from Qxf2</label>
                        </div>
                        <br>
                        <div class="col-md-4 form-display">
                            <label class="col-md-8" for="Candidate Status">Candidate Status:</label>
                            <label class="col-md-8" for="inviteSent">Waiting on Candidate</label>
                        </div>
                        {% endif %}
            </div>

            {% endif %}
            </fieldset>
            </form>
        </div>
    </div>
    </div>
    <script>
        var candidateId = "{{ result.candidate_id }}";
        var jobId = "{{ result.job_id }}";
        $("#urlbutton").click(function () {
            $.ajax({
                type: 'POST',
                url: '/candidate/url',
                data: {
                    'candidateId': candidateId,
                    'jobId': jobId
                },
                success: function (data) {
                    var url_textbox = document.getElementById("generate-url");
                    url_textbox.setAttribute('value', data.url);
                    location.reload();
                }
            })
        }) 
    </script>
    <script>
        function welcome() {
            var url = $("#generate-url").val();
            document.location.href = "/" + url + "/welcome";
        }
    </script>
    <div id="dialog-form" title="Send Email Invite">
        <p class="validateTips">All form fields are required.</p>

        <form>
            <fieldset>

                <label for="generateurl">Generated URL</label>
                <input type="text" name="generatedURL" id="generatedUrl" class="text ui-widget-content ui-corner-all"
                    readonly>
                <input type="hidden" id="candidateName" value="{{result.candidate_name}}">
                <input type="hidden" id="candidateEmail" value="{{result.candidate_email}}">
                <input type="hidden" id="candidateId" value="{{result.candidate_id}}">
                <input type="hidden" id="jobId" value="{{result.job_id}}">
                <label for="select1">Round Level</label>
                <div class="col-md-4">
                    <select name="select1" class="form-control" id="select1" style="width:200px; height:30px;" required>
                        <option value="">Select the below option</option>
                        {% for each_round in round_names %}
                        <option value="{{each_round.round_id,each_round.round_name}}">{{each_round.round_name}}</option>
                        {% endfor %}
                    </select>
                    <div class="valid-feedback">Valid</div>
                    <div class="invalid-feedback">Please fill out this field</div>
                    <div id="resultDiv">
                        <textarea name="rdesc" id="rdesc" style="width:200px; height:300px;" required></textarea>
                    </div>


                </div>
                <script>
                    $("select[name='select1']").change(function () {
                        var dropdownValue = document.getElementById("select1");
                        var roundName = dropdownValue.options[dropdownValue.selectedIndex].value;

                        $.ajax({
                            type: 'POST',
                            url: '/roundname/get-description',
                            data: {
                                'round_name': roundName
                            },
                            success: function (results) {
                                //$("#responds").prepend("<input type='textarea' value='" + results + "'/>");

                                $("#rdesc").text(results.round_description);
                            }

                        })


                    })

                </script>

                <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
            </fieldset>
        </form>
    </div>

    <script>
        var form, dialog
        function sendEmail() {

            var generatedUrl = $("#generatedUrl").val();
            var candidateName = document.getElementById("candidateName").value;
            var candidateEmail = document.getElementById("candidateEmail").value;
            var candidateId = document.getElementById("candidateId").value;
            var jobId = document.getElementById("jobId").value;
            var roundDescription = document.getElementById("rdesc").value;
            $.ajax({
                type: 'POST',
                url: '/candidate/' + candidateId + '/job/' + jobId + '/invite',
                data: {
                    'generatedurl': generatedUrl,
                    'candidatename': candidateName,
                    'candidateid': candidateId,
                    'candidateemail': candidateEmail,
                    'jobid': jobId,
                    'rounddescription': roundDescription
                },
                success: function (result) {

                    if (result.error == "Success") {
                        alert("The Invite has been sent");
                        document.location.href = "/candidates";

                    }
                    else {
                        alert("The invite cannot be sent");
                        document.location.href = "/candidates";
                    }

                }
            })

            dialog.dialog("close");
        }

        dialog = $("#dialog-form").dialog({
            autoOpen: false,
            height: 400,
            width: 350,
            modal: true,
            buttons: {
                "Send Email": sendEmail,
                Cancel: function () {
                    dialog.dialog("close");
                }
            },
            close: function () {
                dialog.dialog("close");

            }
        });


        $("#sendEmail").button().on("click", function () {
            var generatedUrl = $(this).attr("data-generated-url");
            $("#generatedUrl").val(generatedUrl);
            dialog.dialog("open");
        });
    </script>
</body>

</html>