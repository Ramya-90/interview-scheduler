<html>
    <head>
        <title>
            Candidate job status
        </title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--Stylesheets-->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    
    <!--JS-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    

    </head>

    <body>
        <h2 class="grey_text text-center">Candidate Details</h2>
        
        <div class="container col-md-offset-1">
                {% if result.url=="" %}
                <div class="col-md-8">
                    <input id="generate-url" value="generate url" size="40%" readonly/>
                    <button class="btn btn-info" id="urlbutton" type="submit">Generate URL</button>
                </div>
                {% else %}
                <div class="col-md-8">URL:
                    <input id="generate-url" value="{{ result.url }}" size="40%" readonly/>
                    <button class="btn btn-info" id="sendButton" onclick="sendmail()" type="submit">Send Mail</button>
                    <button class="btn btn-info" id="welcomeButton" onclick="welcome()" type="submit">Click Me</button> 
                </div>
                {% endif %}
                <table class="table table-striped">
                <thead>
                   <tr> 
                        <th scope="col">Candidate Name</th>
                        <th>Job Applied</th>      
                    </tr>
                </thead>
                <tbody>
                   {% if result!="" %}
                    <tr>
                        <td>{{ result.candidate_name }}</td>
                        <td>{{ result.job_applied }}</td>
                    </tr>
                    {% endif %}
                </tbody>
        </table>
    </div>
    
    <script>
        var candidateId="{{ result.candidate_id }}";
        var jobId="{{ result.job_id }}";
            $("#urlbutton").on('click', function () {
            $.ajax({
                    type: 'POST',
                    url: '/candidate/url',
                    data: { 
                        'candidateId': candidateId, 
                        'jobId': jobId 
                        },
                    success: function (data) {
                        var url_textbox = document.getElementById("generate-url"); 
                        url_textbox.setAttribute('value', data.url);  
                    }
                })
            window.location.reload();   
        }) 
    </script>
    <script>
    function welcome(){
        var url = $("#generate-url").val();
        document.location.href ="/"+ url + "/welcome";
    }
    </script>
    <script>
        function sendmail(){
        var candidateId="{{ result.candidate_id }}";
        var jobId="{{ result.job_id }}";
        console.log("job id : "+jobId)
            $.ajax({
                    type: 'GET',
                    url: '/candidates/'+candidateId+'/jobs/'+jobId+'/email',
                    data: { 
                        'candidateId': candidateId, 
                        'jobId': jobId 
                        },
                    success: function (data) {
                        alert("Mail successfully sent to"+data.data);  
                    },
                    error: function(error){
                        alert("Candidate does not exist");
                        document.location.href = "/candidates";
                    }
                })
            }
    </script>
</body>
</html>   