name: Interview-Scheduler-Db-Backup
on:
  push:
  pull_request:
  schedule:
    - cron: "* * * * *"
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@master
      - name: create a directory
        run: mkdir -p /tmp/schedule
      - name: list the tmp directory
        run: ls -al /tmp
      - name: Download file via SSH
        uses: nicklasfrahm/scp-action@main
        with:
          direction: download
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.PROD_KEY }}
          port: ${{ secrets.port }}
          insecure_ignore_fingerprint: true
          source: "/home/ubuntu/qxf2/interview-scheduler/data/interviewscheduler.db"
          target: "/scheduler/interviewscheduler.db"
      - name: list the tmp directory
        run: ls -al /tmp/schedule
      - name: Connect s3 bucket
        uses: jakejarvis/s3-sync-action@master
        with:
          args: --acl public-read --follow-symlinks --delete
        env:
          AWS_S3_BUCKET: ${{ secrets.AWS_S3_BUCKET }}
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_REGION: 'us-east-2'   # optional: defaults to us-east-1
          SOURCE_DIR: 'tmp/interviewscheduler.db'
          DEST_DIR: '/'
